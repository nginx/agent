# Codecov configuration file
# This file configures code coverage reporting and requirements for the project
coverage:

  # Coverage status configuration
  status:

    # Project-level coverage settings
    project:

      # Default status check configuration
      default:

        # The minimum required coverage value for the project
        target: 80%

        # The allowed coverage decrease before failing the status check
        threshold: 0%

        # Code coverage check behaviour if the CI fails
        if_ci_failed: error

        # Whether to run coverage checks only on pull requests
        only_pulls: false

    # Patch-level coverage settings
    patch:

      default:

        target: 80%
        threshold: 0%
        if_ci_failed: error
        only_pulls: false

component_management:
    default_rules:
      statuses:
        - type: project
          target: 80%
        - type: patch
          target: 80%

    individual_components:
      - component_id: "internal"
        name: "Internal Packages"
        paths:
            - "internal/**"

      - component_id: "pkg"
        name: "Public Packages"
        paths:
          - "pkg/**"

      - component_id: "cmd"
        name: "Commands"
        paths:
          - "cmd/**"

      - component_id: "api"
        name: "API"
        paths:
          - "api/**"

comment:
  layout: "reach,diff,tree,reach"
  behavior: default
  require_changes: false
  require_base: false
  require_head: false

# Ignore files or packages matching their paths
ignore:
  - '\.pb\.go$'       # Excludes all protobuf generated files
  - '\.gen\.go'      # Excludes generated files
  - '^fake_.*\.go'    # Excludes fakes
  - '^test/.*$'
  - 'app.go'          # app.go and main.go should be tested by integration tests.
  - 'main.go'
  # ignore metadata generated files
  - 'metadata/generated_.*\.go'
  # ignore wrappers around gopsutil
  - 'internal/datasource/host'
  - 'internal/watcher/process'
  - 'pkg/nginxprocess'
